extends KinematicBody2D
class_name Enemy

signal add_score
signal enemy_died
var ep = 100
var inout_vector = Vector2.ZERO
var speed = 50
var velocity = Vector2(0,0)
var score = 0


func _physics_process(delta):
	if ep == 100:
		$AnimationPlayer.play("moveleft")

func ouch():
	$Animationplayer.play("death")
	set_modulate(Color(0.3,0.3,0.3,0.3))

func take_damage(damage):
	emit_signal("add_score")
	$AnimationPlayer.play("death")
	ep -= damage 
	ep -= 1
	if ep <= 0:
		$AnimationPlayer.play("death")

func _on_dieTimer_timeout():
	set_modulate(Color(1,1,1,1))

func _on_AnimationPlayer_animation_finished(death):
	$dieTimer.start()

func _on_sides_checker_body_entered(body):
		$AnimationPlayer.play("moveleft")
		$AnimationPlayer.play("death")
		emit_signal("add_score")
		take_damage(1)
		$dieTimer.start()
		if ep <= 0:
			enemy_died()
		if body.get_collision_layer() == 1:
			if body is Bullet:
				$AnimationPlayer.play("death")
				body.ouch()
		if ep <= 0:
			enemy_died()


func _on_Sprite_animation_finished():
	$AnimationPlayer.play("death")

func enemy_died():
	ep == 0
	if ep == 0:
		$Sprite.play("squashed")
		$dieTimer.start()


func _on_sides_checker_body_shape_exited(body_rid, body, body_shape_index, local_shape_index):
	$AnimationPlayer.play("death")
